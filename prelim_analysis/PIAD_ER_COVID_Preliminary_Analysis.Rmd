---
title: "PIAD Maternal ER, COVID-19 Experiences, and Infant Socioemotional Development: Preliminary Analysis"
author: "Isaac Cormier"
date: "10/31/2025"
output:
  html_document:
    self_contained: true
    code_download: yes
    code_folding: show
    theme:
        bslib: yes
    toc: true
    toc_depth: 5
---
```{css, echo = FALSE}
table caption {
  caption-side: top !important;
}
```

```{r setup, include=FALSE}
knitr::opts_chunk$set(
  echo = TRUE,
  message = FALSE,
  warning = FALSE
)
```

# 1. Background

This report summarizes preliminary regression models examining whether maternal emotion dysregulation (DERS) and prenatal COVID-19 experiences (combined subjective and objective) are associated with BITSEA child socioemotional competence at 15, 24, and 35 months.

# 2. Packages and data

```{r define_pkgs_data}

packages <- c("haven", "here", "dplyr", "purrr", "broom", "knitr", "kableExtra")

if (!require("pacman")) install.packages("pacman")
pacman::p_load(char = packages, character.only = TRUE)

#read data
df <- read_sav(here("data", "COVID-Preg-35MreducedPIAD.sav")) %>% 
  rename(COVID_Comp_Total = AvgObjCOVID40rescale)

#main variables
outcomes <- c(
  "BITSEA_Comp_Total_15M",
  "BITSEA_Comp_Total_24M",
  "BITSEA_Comp_Total_35M"
)
predictors <- c("DERS_Total", "COVID_Comp_Total")

createKable <- function(tbl, title = "My Title"){
  boundary_rows <- which(
    c(FALSE, tbl[[1]][-1] != tbl[[1]][-length(tbl[[1]])])
  )
  
  align_vec <- c("l", rep("r", ncol(tbl) - 1))
  
  kable(
    tbl,
    col.names = names(tbl),
    align     = align_vec,
    digits    = 4,        
    format    = "html",
    caption   = title
  ) %>%
    kable_styling(
      bootstrap_options = c("condensed", "bordered"),
      full_width        = FALSE,
      position          = "left"
    ) %>%
    column_spec(
      which(sapply(tbl, is.numeric)),
      width     = "60px",
      extra_css = "padding-left:6px; padding-right:6px;"
    ) %>% 
    row_spec(
      boundary_rows,
      extra_css = "border-top: 3px solid black;"
    ) %>%
        scroll_box(width = "1000px", height = "400px")
}
```

# 3. Check Missing Values

```{r missingVals}
missing <- df %>% 
  select(all_of(c(outcomes, predictors))) %>% 
  summarise(across(everything(), ~ sum(is.na(.))))

createKable(
  missing,
  title = "Number of missing values by Variable"
)
```

# 4. Diagnostic plots and normality

Creates regression diagnsotic plots to check that asssumptions of normality are met before running the models.
Also runs Shapiro-Wilks Test of Normality (although it is important to interpret the results of this test alongside the Q-Q Plot). 

```{r diagnostics}
check_assumptions <- function(data, outcome) {
        model <- lm(as.formula(paste0(outcome, " ~ DERS_Total + COVID_Comp_Total")), data=data)
        #Save plot as png file
        outfile <- here("prelim_analysis", "plots", paste0(outcome, "_diagnostic_plot.png"))
        dir.create(dirname(outfile), showWarnings = FALSE, recursive = TRUE)
        png(outfile, width = 1200, height = 1200)
        par(mfrow = c(2,2))
        plot(model)
        dev.off()
        #Send plot to viewer
        par(mfrow = c(2,2))
        plot(model)
        
        #Print shaprio-wilk test results from residuals
        resid <- residuals(model)
        shapWilk <- shapiro.test(resid)
        print(shapWilk)
}
```
## Regression Diagnostics for BITSEA Total Composite Score at 15M

```{r 15M_diagnostic}
check_assumptions(df, "BITSEA_Comp_Total_15M")
```

## Regression Diagnostics for BITSEA Total Composite Score at 24M

```{r 24M_diagnostic}
check_assumptions(df, "BITSEA_Comp_Total_24M")
```

## Regression Diagnostics for BITSEA Total Composite Score at 35M

```{r 35M_diagnostic}
check_assumptions(df, "BITSEA_Comp_Total_35M")
```


# 5. Run the Regression Models

For each outcome variable (BITSEA_Comp_Total_15M, BITSEA_Comp_Total_24M, BITSEA_Comp_Total_35M), there are four models:
        1) A main-effects model of the raw DERS_Total and COVID_Comp_Total predictor variables
        2) A main-effects model of the standardized DERS_Total and COVID_Comp_Total predictor variables
        3) An interaction effect model of the raw DERS_Total and COVID_Comp_Total predictor variables
        4) An interaction effect model of the standardized DERS_Total and COVID_Comp_Total predictor variables
        
Model versions with standardized predictors were prepared underneath the raw models due to the value of centering the predictors of a model prior to running regression analysis (See Cohen et al.'s (2003) textbook "Applied multiple regression/correlation analysis for the behavioral sciences (3rd ed.)").

```{r regression_model}
run_bitsea_model <- function(data, outcome, standardize_predictors=FALSE) {
        vars <- c(outcome, "DERS_Total", "COVID_Comp_Total")
        data <- data[, vars]
        
        if (isTRUE(standardize_predictors)){
                std_preds <- scale(select(data, DERS_Total, COVID_Comp_Total)) #standardize the predictors
                std_preds <- as.data.frame(std_preds) #convert the standardized predictors back to the dataframe
                
                data$DERS_Total <- std_preds$DERS_Total
                data$COVID_Comp_Total <- std_preds$COVID_Comp_Total
        }
        #Main effect model
        main_fml <- as.formula(paste0(outcome, " ~ DERS_Total + COVID_Comp_Total"))
        main_model <- lm(main_fml, data=data)
        #Interaction effect model
        int_fml <- as.formula(paste0(outcome, " ~ DERS_Total * COVID_Comp_Total"))
        int_model <- lm(int_fml, data=data)
        
        list(
                outcome = outcome, 
                main_model = main_model,
                int_model = int_model
        )
}

model_list <- map(outcomes, ~run_bitsea_model(df, .x))
names(model_list) <- outcomes

std_model_list <- map(outcomes, ~run_bitsea_model(df, .x, TRUE))
names(std_model_list) <- outcomes
```

## a) Regression Results for BITSEA Total Composite Score at 15 Months

### i) Main-effects for 15M

```{r main_15}
summary(model_list[["BITSEA_Comp_Total_15M"]]$main_model)
```

### ii) Standardized Main-effects for 15M
```{r stdmain_15}
summary(std_model_list[["BITSEA_Comp_Total_15M"]]$main_model)
```

### iii) Interaction-effects for 15M
```{r int_15}
summary(model_list[["BITSEA_Comp_Total_15M"]]$int_model)
```

### iv) Standardized interaction-effects for 15M

```{r stdint_15}
summary(std_model_list[["BITSEA_Comp_Total_15M"]]$int_model)
```


## b) Regression Results for BITSEA Total Composite Score at 24 Months

### i) Main-effects for 24M

```{r main_24M}
summary(model_list[["BITSEA_Comp_Total_24M"]]$main_model)
```

### ii) Standardized Main-effects for 24M
```{r stdmain_24M}
summary(std_model_list[["BITSEA_Comp_Total_24M"]]$main_model)
```

### iii) Interaction-effects for 24M
```{r int_24M}
summary(model_list[["BITSEA_Comp_Total_24M"]]$int_model)
```

### iv) Standardized interaction-effects for 24M

```{r stdint_24M}
summary(std_model_list[["BITSEA_Comp_Total_24M"]]$int_model)
```

## c) Regression Results for BITSEA Total Composite Score at 35 Months

### i) Main-effects for 35M

```{r main_35M}
summary(model_list[["BITSEA_Comp_Total_35M"]]$main_model)
```

### ii) Standardized Main-effects for 35M
```{r stdmain_35M}
summary(std_model_list[["BITSEA_Comp_Total_35M"]]$main_model)
```

### iii) Interaction-effects for 35M
```{r int_35M}
summary(model_list[["BITSEA_Comp_Total_35M"]]$int_model)
```

### iv) Standardized interaction-effects for 35M

```{r stdint_35M}
summary(std_model_list[["BITSEA_Comp_Total_35M"]]$int_model)
```

